 <div class="container chat-container"
     data-controller="chat-subscription"
     data-chat-subscription-chat-id-value="<%= @chat.id %>">

  <% profile_to_show = @chat.sender_id == current_user.id ? @chat.receiver : @chat.sender %>

  <header class="chat-header">
    <h1><%= profile_to_show.fullname %></h1>
  </header>

  <div class="messages" data-chat-subscription-target="messages">
    <% @chat.messages.order(:created_at).each do |message| %>
      <%= render "messages/message", message: message, current_user: current_user %>
    <% end %>
  </div>

  <%= form_with(model: [@user, @chat, @message], 
              local: false,  # Ensure this is set to false for remote submission
              class: "message-form",
              remote: true, 
              data: { 
                controller: "chat-subscription",  # Correct controller name
                action: "turbo:submit-end->chat-subscription#afterMessageSent"
              }) do |f| %>
  <div class="message-input">
    <%= f.text_area :body,
      placeholder: "Message to #{profile_to_show.fullname}",
      rows: 1,
      class: "form-control",
      data: { 
        chat_subscription_target: "messageInput",
        action: "keydown->chat-subscription#submitOnEnter"
      } %>
  </div>
  <%= f.submit "Send", class: "btn btn-primary send-btn" %>
<% end %>
</div>

<style>
  .chat-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }
  .chat-header {
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
  }
  .messages {
    height: 400px;
    overflow-y: auto;
    margin-bottom: 20px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
  }
  .message-form {
    display: flex;
    gap: 10px;
  }
  .message-input {
    flex-grow: 1;
  }
  .form-control {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    resize: none;
  }
  .send-btn {
    align-self: flex-end;
  }
</style>